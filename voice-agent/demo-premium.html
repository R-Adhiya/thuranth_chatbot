<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDCP Voice Agent - Premium UI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        // White, Green, Purple Color Scheme
                        "primary": "#8b5cf6",        // Purple
                        "primary-dark": "#7c3aed",   // Darker purple
                        "secondary": "#10b981",      // Green
                        "secondary-dark": "#059669", // Darker green
                        "accent": "#a855f7",         // Light purple
                        "success": "#10b981",        // Green
                        "warning": "#f59e0b",
                        "danger": "#ef4444",
                        
                        // White-Green-Purple Theme
                        "bg-primary": "#ffffff",      // Pure white
                        "bg-secondary": "#f8fafc",    // Off white
                        "bg-accent": "#f3f4f6",       // Light gray
                        
                        "surface-primary": "#ffffff", // White surfaces
                        "surface-secondary": "#f9fafb", // Light surfaces
                        "surface-green": "#ecfdf5",   // Light green
                        "surface-purple": "#faf5ff",  // Light purple
                        
                        "text-primary": "#1f2937",   // Dark gray
                        "text-secondary": "#6b7280", // Medium gray
                        "text-accent": "#9ca3af",    // Light gray
                        "text-white": "#ffffff",     // Pure white
                        
                        "border-primary": "#e5e7eb", // Light border
                        "border-secondary": "#d1d5db", // Medium border
                        "border-green": "#10b981",   // Green border
                        "border-purple": "#8b5cf6",  // Purple border
                        
                        "gradient-green": "#10b981",
                        "gradient-purple": "#8b5cf6",
                    },
                    fontFamily: {
                        "sans": ["Inter", "system-ui", "sans-serif"]
                    },
                    borderRadius: {
                        "xl": "1rem",
                        "2xl": "1.5rem",
                        "3xl": "2rem",
                    },
                    boxShadow: {
                        "glow-green": "0 0 20px rgba(16, 185, 129, 0.3)",
                        "glow-purple": "0 0 20px rgba(139, 92, 246, 0.3)",
                        "glow-lg": "0 0 40px rgba(139, 92, 246, 0.4)",
                        "card": "0 4px 20px rgba(0, 0, 0, 0.1)",
                        "card-hover": "0 8px 32px rgba(0, 0, 0, 0.15)",
                        "green": "0 4px 20px rgba(16, 185, 129, 0.2)",
                        "purple": "0 4px 20px rgba(139, 92, 246, 0.2)",
                    },
                    animation: {
                        "pulse-slow": "pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite",
                        "bounce-slow": "bounce 2s infinite",
                        "fade-in": "fadeIn 0.5s ease-out",
                        "slide-up": "slideUp 0.3s ease-out",
                        "scale-in": "scaleIn 0.2s ease-out",
                        "gradient-shift": "gradientShift 3s ease infinite",
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0.9)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' },
                        },
                        gradientShift: {
                            '0%, 100%': { backgroundPosition: '0% 50%' },
                            '50%': { backgroundPosition: '100% 50%' },
                        },
                    },
                },
            },
        }
    </script>
    <style>
        /* White-Green-Purple Glassmorphism Effects */
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
        
        .glass-white {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(229, 231, 235, 0.8);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }
        
        .glass-green {
            background: rgba(236, 253, 245, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(16, 185, 129, 0.3);
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.1);
        }
        
        .glass-purple {
            background: rgba(250, 245, 255, 0.9);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.1);
        }
        
        /* White-Green-Purple Gradient Backgrounds */
        .gradient-green-purple {
            background: linear-gradient(135deg, #10b981 0%, #8b5cf6 100%);
        }
        
        .gradient-purple-green {
            background: linear-gradient(135deg, #8b5cf6 0%, #10b981 100%);
        }
        
        .gradient-white-green {
            background: linear-gradient(135deg, #ffffff 0%, #ecfdf5 100%);
        }
        
        .gradient-white-purple {
            background: linear-gradient(135deg, #ffffff 0%, #faf5ff 100%);
        }
        
        /* Enhanced Button Styles for White-Green-Purple */
        .btn-white {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            color: #1f2937;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        
        .btn-green {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-purple {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }
        
        .btn-green-purple {
            background: linear-gradient(135deg, #10b981 0%, #8b5cf6 100%);
            border: 1px solid rgba(139, 92, 246, 0.3);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.2);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }
        
        /* Advanced Pulse Animation */
        @keyframes advancedPulse {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.7);
            }
            50% { 
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(99, 102, 241, 0);
            }
        }
        
        .pulse-advanced {
            animation: advancedPulse 2s infinite;
        }
        
        /* Gradient Text */
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.6);
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: rgba(99, 102, 241, 0.8);
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Typing Dots Animation */
        @keyframes typingDots {
            0%, 20% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .typing-dot:nth-child(1) { animation: typingDots 1.4s infinite; }
        .typing-dot:nth-child(2) { animation: typingDots 1.4s infinite 0.2s; }
        .typing-dot:nth-child(3) { animation: typingDots 1.4s infinite 0.4s; }
        
        /* Message Bubble Animations */
        .message-enter {
            animation: slideUp 0.3s ease-out;
        }
        
        /* Voice Wave Animation */
        @keyframes voiceWave {
            0%, 100% { height: 4px; }
            50% { height: 20px; }
        }
        
        .voice-wave {
            animation: voiceWave 0.8s ease-in-out infinite;
        }
        
        .voice-wave:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave:nth-child(4) { animation-delay: 0.3s; }
        .voice-wave:nth-child(5) { animation-delay: 0.4s; }
        
        /* Particle Background for White Theme */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            border-radius: 50%;
            animation: particleFloat 25s linear infinite;
        }
        
        .particle.green {
            background: rgba(16, 185, 129, 0.4);
        }
        
        .particle.purple {
            background: rgba(139, 92, 246, 0.4);
        }
        
        @keyframes particleFloat {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-bg-primary text-text-primary font-sans overflow-hidden">
    <!-- Animated Particle Background -->
    <div class="particles" id="particles"></div>
    
    <!-- Main Container with Wider Aspect Ratio -->
    <div class="relative min-h-screen flex bg-gradient-to-br from-bg-primary via-bg-secondary to-surface-green">
        <!-- Chat Interface with Increased Width -->
        <div class="flex-1 flex flex-col max-w-2xl mx-auto relative z-10 w-full">
            <!-- Header with White-Green-Purple Theme -->
            <div class="glass-white p-8 border-b border-border-primary shadow-card">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center space-x-4">
                        <div class="w-12 h-12 rounded-2xl gradient-green-purple flex items-center justify-center shadow-purple">
                            <span class="material-symbols-outlined text-white text-xl font-medium">psychology</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold bg-gradient-to-r from-secondary to-primary bg-clip-text text-transparent">PDCP Assistant</h1>
                            <p class="text-sm text-text-secondary">AI-Powered Delivery Support</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <div class="w-3 h-3 bg-secondary rounded-full animate-pulse shadow-glow-green"></div>
                        <span class="text-sm text-secondary font-semibold">Online</span>
                    </div>
                </div>
                
                <!-- Premium Parcel Selector -->
                <div class="mb-6">
                    <select id="parcelSelector" class="w-full glass-white rounded-2xl px-6 py-4 text-text-primary border border-border-primary focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300 cursor-pointer shadow-card">
                        <option value="" class="bg-surface-primary text-text-primary">üöö Select Your Parcel</option>
                        <option value="PKG001" class="bg-surface-primary text-text-primary">üì¶ PKG001 - Express Delivery (Mumbai)</option>
                        <option value="PKG002" class="bg-surface-primary text-text-primary">üì¶ PKG002 - Standard Delivery (Mumbai)</option>
                        <option value="PKG003" class="bg-surface-primary text-text-primary">üì¶ PKG003 - Priority Delivery (Mumbai)</option>
                    </select>
                </div>
                
                <!-- Language Selector with Call Button -->
                <div class="flex items-center space-x-4">
                    <!-- Language Buttons -->
                    <div class="flex space-x-3 flex-1">
                        <button class="lang-btn active flex-1 py-3 px-4 rounded-xl btn-purple text-white text-sm font-semibold transition-all duration-300 hover:scale-105 shadow-purple" onclick="setLanguage('en')">
                            üá∫üá∏ EN
                        </button>
                        <button class="lang-btn flex-1 py-3 px-4 rounded-xl btn-white text-text-primary text-sm font-semibold transition-all duration-300 hover:scale-105 hover:shadow-card" onclick="setLanguage('hi')">
                            üáÆüá≥ ‡§π‡§ø
                        </button>
                        <button class="lang-btn flex-1 py-3 px-4 rounded-xl btn-white text-text-primary text-sm font-semibold transition-all duration-300 hover:scale-105 hover:shadow-card" onclick="setLanguage('ta')">
                            üáÆüá≥ ‡Æ§
                        </button>
                        <button class="lang-btn flex-1 py-3 px-4 rounded-xl btn-white text-text-primary text-sm font-semibold transition-all duration-300 hover:scale-105 hover:shadow-card" onclick="setLanguage('te')">
                            üáÆüá≥ ‡∞§‡±Ü
                        </button>
                    </div>
                    
                    <!-- Call Button in Header -->
                    <button id="callButton" class="btn-premium w-14 h-14 rounded-2xl btn-green text-white shadow-glow-green hover:shadow-green transition-all duration-300 hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center" onclick="startCall()" disabled title="Select a parcel first">
                        <span class="material-symbols-outlined text-xl font-medium">call</span>
                    </button>
                </div>
            </div>
            
            <!-- Messages Area with White-Green-Purple Styling -->
            <div id="messagesArea" class="flex-1 p-8 overflow-y-auto custom-scrollbar space-y-6" style="height: calc(100vh - 320px);">
                <!-- Welcome Message -->
                <div class="message agent message-enter">
                    <div class="flex items-start space-x-4">
                        <div class="w-10 h-10 rounded-full gradient-green-purple flex items-center justify-center flex-shrink-0 mt-1 shadow-purple">
                            <span class="material-symbols-outlined text-white text-sm font-medium">psychology</span>
                        </div>
                        <div class="flex-1">
                            <div class="glass-purple rounded-2xl rounded-tl-md p-5 shadow-card">
                                <p class="text-text-primary leading-relaxed font-medium">
                                    üëã Welcome to PDCP AI Assistant! I'm here to help you with delivery management, customer communication, and route optimization. 
                                    <br><br>
                                    Please select a parcel to get started with personalized assistance.
                                </p>
                            </div>
                            <div class="flex items-center space-x-2 mt-3 ml-3">
                                <span class="text-xs text-text-secondary">12:00 PM</span>
                                <div class="flex space-x-1">
                                    <div class="w-1.5 h-1.5 bg-secondary rounded-full"></div>
                                    <div class="w-1.5 h-1.5 bg-secondary rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Typing Indicator -->
            <div id="typingIndicator" class="hidden px-8 py-3">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 rounded-full gradient-green-purple flex items-center justify-center shadow-purple">
                        <span class="material-symbols-outlined text-white text-sm font-medium">psychology</span>
                    </div>
                    <div class="glass-white rounded-2xl rounded-tl-md px-5 py-4 shadow-card">
                        <div class="flex items-center space-x-3">
                            <span class="text-text-secondary text-sm font-medium">AI is thinking</span>
                            <div class="flex space-x-1">
                                <div class="typing-dot w-2 h-2 bg-primary rounded-full"></div>
                                <div class="typing-dot w-2 h-2 bg-primary rounded-full"></div>
                                <div class="typing-dot w-2 h-2 bg-primary rounded-full"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Premium Input Area with White-Green-Purple -->
            <div class="glass-white p-8 border-t border-border-primary shadow-card">
                <!-- Main Input Row -->
                <div class="flex items-end space-x-4 mb-6">
                    <!-- Voice Input Button -->
                    <button id="chatVoiceBtn" class="btn-premium w-14 h-14 rounded-2xl btn-green text-white flex items-center justify-center transition-all duration-300 hover:scale-105 hover:shadow-glow-green flex-shrink-0" onclick="toggleChatVoice()">
                        <span class="material-symbols-outlined text-lg font-medium">mic</span>
                    </button>
                    
                    <!-- Message Input Container -->
                    <div class="flex-1 relative">
                        <textarea 
                            id="messageInput" 
                            placeholder="Type your message or use voice input..."
                            class="w-full glass-white rounded-2xl px-6 py-4 pr-20 text-text-primary placeholder-text-accent resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-all duration-300 min-h-[56px] max-h-36 border border-border-primary shadow-card"
                            rows="1"
                            onkeypress="handleKeyPress(event)"
                            oninput="adjustTextareaHeight(this)"
                        ></textarea>
                        <!-- Character Counter -->
                        <div class="absolute bottom-3 right-4 text-xs text-text-accent pointer-events-none font-medium" id="charCounter">0/500</div>
                    </div>
                    
                    <!-- Send Button -->
                    <button id="sendBtn" class="btn-premium w-14 h-14 rounded-2xl btn-purple text-white flex items-center justify-center transition-all duration-300 hover:scale-105 hover:shadow-glow-purple disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0" onclick="sendMessage()" disabled>
                        <span class="material-symbols-outlined text-lg font-medium">send</span>
                    </button>
                    
                    <!-- Auto-speak Button -->
                    <button id="speakBtn" class="btn-premium w-14 h-14 rounded-2xl btn-white text-text-secondary hover:text-text-primary flex items-center justify-center transition-all duration-300 hover:scale-105 flex-shrink-0" onclick="toggleAutoSpeak()">
                        <span class="material-symbols-outlined text-lg font-medium">volume_up</span>
                    </button>
                </div>
                
                <!-- Quick Actions Row -->
                <div class="flex flex-wrap gap-3 justify-center">
                    <button class="quick-action px-4 py-3 btn-white hover:btn-green rounded-xl text-sm text-text-primary hover:text-white transition-all duration-300 flex items-center space-x-2 hover:scale-105 shadow-card" onclick="sendQuickMessage('status')">
                        <span>üìç</span>
                        <span class="font-medium">Status</span>
                    </button>
                    <button class="quick-action px-4 py-3 btn-white hover:btn-purple rounded-xl text-sm text-text-primary hover:text-white transition-all duration-300 flex items-center space-x-2 hover:scale-105 shadow-card" onclick="sendQuickMessage('location')">
                        <span>üó∫Ô∏è</span>
                        <span class="font-medium">Location</span>
                    </button>
                    <button class="quick-action px-4 py-3 btn-white hover:btn-green-purple rounded-xl text-sm text-text-primary hover:text-white transition-all duration-300 flex items-center space-x-2 hover:scale-105 shadow-card" onclick="sendQuickMessage('help')">
                        <span>‚ùì</span>
                        <span class="font-medium">Help</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Premium Call Interface with White-Green-Purple Theme -->
    <div id="callOverlay" class="hidden fixed inset-0 bg-gradient-to-br from-bg-primary via-surface-green to-surface-purple z-50">
        <!-- Gradient Background -->
        <div class="absolute inset-0 gradient-white-green opacity-20"></div>
        
        <!-- Call Header -->
        <div class="relative z-10 flex items-center justify-between p-8 pt-16">
            <button onclick="endCall()" class="w-14 h-14 rounded-2xl glass-white hover:glass text-text-primary flex items-center justify-center transition-all duration-300 hover:scale-105 shadow-card">
                <span class="material-symbols-outlined text-2xl font-medium">keyboard_arrow_down</span>
            </button>
            <div class="text-center">
                <h2 class="text-2xl font-bold text-text-primary">Voice Assistant</h2>
                <p id="callDuration" class="text-text-secondary text-base mt-2">00:00</p>
            </div>
            <div class="w-14 h-14 rounded-2xl glass-green flex items-center justify-center shadow-green">
                <div class="w-4 h-4 bg-secondary rounded-full animate-pulse shadow-glow-green"></div>
            </div>
        </div>
        
        <!-- Call Main Content -->
        <div class="relative z-10 flex-1 flex flex-col items-center justify-center px-10">
            <!-- Premium Avatar with White-Green-Purple Effects -->
            <div class="relative mb-16">
                <!-- Outer Glow Ring -->
                <div id="avatarGlow" class="absolute inset-0 rounded-full gradient-green-purple opacity-40 blur-2xl scale-150"></div>
                
                <!-- Pulse Rings -->
                <div class="absolute inset-0 rounded-full border-3 border-secondary/40 animate-ping"></div>
                <div class="absolute inset-0 rounded-full border-3 border-primary/30 animate-ping" style="animation-delay: 0.5s;"></div>
                
                <!-- Main Avatar -->
                <div class="relative w-40 h-40 rounded-full gradient-green-purple flex items-center justify-center shadow-card">
                    <!-- Voice Wave Visualization -->
                    <div id="voiceWaves" class="hidden flex items-center justify-center space-x-2">
                        <div class="voice-wave w-1.5 bg-white rounded-full"></div>
                        <div class="voice-wave w-1.5 bg-white rounded-full"></div>
                        <div class="voice-wave w-1.5 bg-white rounded-full"></div>
                        <div class="voice-wave w-1.5 bg-white rounded-full"></div>
                        <div class="voice-wave w-1.5 bg-white rounded-full"></div>
                    </div>
                    
                    <!-- Default State -->
                    <div id="avatarDefault" class="flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-6xl font-medium">psychology</span>
                    </div>
                </div>
            </div>
            
            <!-- AI Status -->
            <div class="text-center mb-10">
                <h1 class="text-4xl font-bold text-text-primary mb-3">PDCP AI Assistant</h1>
                <p id="callStatus" class="text-text-secondary text-xl">Tap the microphone to speak</p>
            </div>
            
            <!-- Voice Transcript -->
            <div id="callTranscript" class="hidden glass-purple rounded-3xl p-8 max-w-lg w-full mb-10 animate-fade-in shadow-purple">
                <div class="text-base text-text-secondary mb-3 flex items-center font-medium">
                    <span class="material-symbols-outlined text-xl mr-3 font-medium">record_voice_over</span>
                    You said:
                </div>
                <div id="transcriptText" class="text-text-primary font-semibold text-lg"></div>
            </div>
            
            <!-- Selected Parcel Info -->
            <div id="selectedParcelInfo" class="hidden glass-green rounded-3xl p-8 max-w-lg w-full mb-10 shadow-green">
                <div class="text-base text-secondary mb-3 flex items-center font-medium">
                    <span class="material-symbols-outlined text-xl mr-3 font-medium">local_shipping</span>
                    Active Parcel:
                </div>
                <div id="selectedParcelText" class="text-text-primary font-semibold text-lg"></div>
            </div>
        </div>
        
        <!-- Premium Call Controls -->
        <div class="relative z-10 pb-16 px-10">
            <!-- Secondary Controls -->
            <div class="flex items-center justify-center space-x-12 mb-16">
                <button class="flex flex-col items-center space-y-3 group">
                    <div class="w-20 h-20 rounded-3xl glass-white hover:glass flex items-center justify-center transition-all duration-300 group-hover:scale-105 shadow-card">
                        <span class="material-symbols-outlined text-3xl text-text-primary font-medium">mic_off</span>
                    </div>
                    <span class="text-base font-medium text-text-secondary group-hover:text-text-primary transition-colors">Mute</span>
                </button>
                
                <!-- Main Voice Button -->
                <button id="voiceBtn" onclick="toggleVoiceRecognition()" class="flex flex-col items-center space-y-3 group">
                    <div class="w-24 h-24 rounded-3xl gradient-green-purple hover:gradient-purple-green flex items-center justify-center transition-all duration-300 group-hover:scale-105 shadow-purple pulse-advanced">
                        <span class="material-symbols-outlined text-4xl text-white font-medium">mic</span>
                    </div>
                    <span class="text-base font-semibold text-text-primary">Speak</span>
                </button>
                
                <button class="flex flex-col items-center space-y-3 group">
                    <div class="w-20 h-20 rounded-3xl glass-white hover:glass flex items-center justify-center transition-all duration-300 group-hover:scale-105 shadow-card">
                        <span class="material-symbols-outlined text-3xl text-text-primary font-medium">volume_up</span>
                    </div>
                    <span class="text-base font-medium text-text-secondary group-hover:text-text-primary transition-colors">Speaker</span>
                </button>
            </div>
            
            <!-- End Call Button -->
            <div class="flex justify-center">
                <button onclick="endCall()" class="btn-premium flex items-center justify-center space-x-4 btn-danger text-white px-10 py-5 rounded-3xl transition-all duration-300 hover:scale-105 shadow-card">
                    <span class="material-symbols-outlined text-3xl font-medium">call_end</span>
                    <span class="text-xl font-bold">End Call</span>
                </button>
            </div>
        </div>
    </div>

    <script src="demo-config.js"></script>
    <script>
        // Global state
        let selectedParcel = null;
        let currentLanguage = 'en';
        let isListening = false;
        let isSpeaking = false;
        let callStartTime = null;
        let callDurationInterval = null;
        let recognition = null;
        let synthesis = window.speechSynthesis;
        
        // Chat voice features
        let isChatListening = false;
        let autoSpeakEnabled = false;
        let chatRecognition = null;
        
        // Premium UI features
        let particleInterval = null;
        
        // LLM Service (Enhanced)
        class PremiumLLMService {
            constructor(config) {
                this.config = config;
            }
            
            async processMessage(text, parcel, language) {
                try {
                    const prompt = this.buildPrompt(text, parcel, language);
                    return await this.callLLM(prompt);
                } catch (error) {
                    console.error('LLM Error:', error);
                    return this.getFallbackResponse(language);
                }
            }
            
            buildPrompt(text, parcel, language) {
                const systemPrompt = language === 'en' 
                    ? "You are PDCP AI Assistant, a premium AI helper for delivery professionals. Provide detailed, helpful responses with emojis and professional tone."
                    : "‡§Ü‡§™ PDCP AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•à‡§Ç, ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§™‡•á‡§∂‡•á‡§µ‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ AI ‡§∏‡§π‡§æ‡§Ø‡§ï‡•§ ‡§á‡§Æ‡•ã‡§ú‡•Ä ‡§î‡§∞ ‡§™‡•á‡§∂‡•á‡§µ‡§∞ ‡§ü‡•ã‡§® ‡§ï‡•á ‡§∏‡§æ‡§• ‡§µ‡§ø‡§∏‡•ç‡§§‡•É‡§§, ‡§∏‡§π‡§æ‡§Ø‡§ï ‡§â‡§§‡•ç‡§§‡§∞ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§";
                
                const parcelInfo = parcel 
                    ? `Selected Parcel: ${parcel.id} to ${parcel.destination} (Status: ${parcel.status})`
                    : '';
                
                return `${systemPrompt}\n${parcelInfo}\nUser: ${text}\nAssistant:`;
            }
            
            async callLLM(prompt) {
                if (this.config.provider === 'gemini') {
                    return this.callGemini(prompt);
                } else if (this.config.provider === 'groq') {
                    return this.callGroq(prompt);
                } else {
                    return this.getFallbackResponse('en');
                }
            }
            
            async callGemini(prompt) {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/${this.config.model}:generateContent?key=${this.config.apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: {
                                temperature: this.config.temperature,
                                maxOutputTokens: this.config.maxTokens,
                            },
                        }),
                    }
                );
                
                if (!response.ok) {
                    throw new Error(`Gemini API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.candidates?.[0]?.content?.parts?.[0]?.text || this.getFallbackResponse('en');
            }
            
            async callGroq(prompt) {
                const response = await fetch(`${this.config.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${this.config.apiKey}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        model: this.config.model,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: this.config.temperature,
                        max_tokens: this.config.maxTokens,
                    }),
                });
                
                if (!response.ok) {
                    throw new Error(`Groq API error: ${response.status}`);
                }
                
                const data = await response.json();
                return data.choices?.[0]?.message?.content || this.getFallbackResponse('en');
            }
            
            getFallbackResponse(language) {
                const responses = {
                    en: "üöÄ I'm your premium PDCP AI Assistant! I can help with delivery tracking üì¶, route optimization üó∫Ô∏è, customer communication üìû, and much more. What would you like assistance with today?",
                    hi: "üöÄ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ PDCP AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Ç! ‡§Æ‡•à‡§Ç ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó üì¶, ‡§∞‡•Ç‡§ü ‡§ë‡§™‡•ç‡§ü‡§ø‡§Æ‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§® üó∫Ô∏è, ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡§Ç‡§ö‡§æ‡§∞ üìû ‡§î‡§∞ ‡§¨‡§π‡•Å‡§§ ‡§ï‡•Å‡§õ ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Ç‡•§ ‡§Ü‡§ú ‡§Ü‡§™ ‡§ï‡§ø‡§∏ ‡§ö‡•Ä‡§ú‡§º ‡§Æ‡•á‡§Ç ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ö‡§æ‡§π‡•á‡§Ç‡§ó‡•á?"
                };
                return responses[language] || responses.en;
            }
        }
        
        // Initialize LLM service
        let llmService = null;
        
        // Check if API key is configured
        function checkAPIKey() {
            const config = window.DEMO_CONFIG?.llm;
            if (!config || !config.apiKey || config.apiKey.includes('YOUR_')) {
                return false;
            }
            return true;
        }
        
        // Initialize services
        function initializeServices() {
            if (checkAPIKey()) {
                llmService = new PremiumLLMService(window.DEMO_CONFIG.llm);
                console.log('‚úÖ Premium LLM Service initialized with', window.DEMO_CONFIG.llm.provider);
            } else {
                console.log('‚ö†Ô∏è No API key configured, using premium fallback responses');
                llmService = {
                    processMessage: async (text, parcel, language) => {
                        return generatePremiumFallbackResponse(text, parcel, language);
                    }
                };
            }
        }
        
        // Premium fallback response generator
        function generatePremiumFallbackResponse(message, parcel, language) {
            const lowerMessage = message.toLowerCase();
            
            if (!parcel) {
                return language === 'hi' 
                    ? "üéØ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡§π‡§≤‡•á ‡§è‡§ï ‡§™‡§æ‡§∞‡•ç‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•ã ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§™‡•ç‡§∞‡§¶‡§æ‡§® ‡§ï‡§∞ ‡§∏‡§ï‡•Ç‡§Ç‡•§ üì¶"
                    : "üéØ Please select a parcel first so I can provide you with personalized assistance! üì¶";
            }
            
            if (lowerMessage.includes('status') || lowerMessage.includes('delivery')) {
                return language === 'hi'
                    ? `üì¶ ‡§Ü‡§™‡§ï‡§æ ‡§™‡§æ‡§∞‡•ç‡§∏‡§≤ ${parcel.id} ‡§µ‡§∞‡•ç‡§§‡§Æ‡§æ‡§® ‡§Æ‡•á‡§Ç ${parcel.status} ‡§∏‡•ç‡§•‡§ø‡§§‡§ø ‡§Æ‡•á‡§Ç ‡§π‡•à‡•§\nüéØ ‡§ó‡§Ç‡§§‡§µ‡•ç‡§Ø: ${parcel.destination}\n‚è∞ ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡•à‡§Ç ‡§Ø‡§π‡§æ‡§Å ‡§π‡•Ç‡§Å!`
                    : `üì¶ Your parcel ${parcel.id} is currently ${parcel.status}.\nüéØ Destination: ${parcel.destination}\n‚è∞ I'll keep you updated with real-time information!`;
            }
            
            if (lowerMessage.includes('where') || lowerMessage.includes('location')) {
                return language === 'hi'
                    ? `üó∫Ô∏è ‡§Ü‡§™‡§ï‡§æ ‡§™‡§æ‡§∞‡•ç‡§∏‡§≤ ${parcel.id} ‡§Ø‡§π‡§æ‡§Å ‡§ú‡§æ ‡§∞‡§π‡§æ ‡§π‡•à: ${parcel.destination}\nüìç ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•ã ‡§≤‡§æ‡§á‡§µ ‡§ü‡•ç‡§∞‡•à‡§ï‡§ø‡§Ç‡§ó ‡§Ö‡§™‡§°‡•á‡§ü ‡§¶‡•á ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å!`
                    : `üó∫Ô∏è Your parcel ${parcel.id} is heading to: ${parcel.destination}\nüìç I can provide you with live tracking updates!`;
            }
            
            if (lowerMessage.includes('help')) {
                return language === 'hi'
                    ? "üöÄ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡•Ä ‡§Æ‡§¶‡§¶ ‡§ï‡§∞ ‡§∏‡§ï‡§§‡§æ ‡§π‡•Ç‡§Å:\nüì¶ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§∏‡•ç‡§ü‡•á‡§ü‡§∏ ‡§ö‡•á‡§ï ‡§ï‡§∞‡§®‡§æ\nüó∫Ô∏è ‡§∞‡•Ç‡§ü ‡§ë‡§™‡•ç‡§ü‡§ø‡§Æ‡§æ‡§á‡§ú‡§º‡•á‡§∂‡§®\nüìû ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞ ‡§ï‡§Æ‡•ç‡§Ø‡•Å‡§®‡§ø‡§ï‡•á‡§∂‡§®\n‚ö° ‡§∞‡§ø‡§Ø‡§≤-‡§ü‡§æ‡§á‡§Æ ‡§Ö‡§™‡§°‡•á‡§ü‡•ç‡§∏\n\n‡§ï‡•ç‡§Ø‡§æ ‡§ö‡§æ‡§π‡§ø‡§è ‡§Ü‡§™‡§ï‡•ã?"
                    : "üöÄ I can help you with:\nüì¶ Delivery status tracking\nüó∫Ô∏è Route optimization\nüìû Customer communication\n‚ö° Real-time updates\n\nWhat do you need assistance with?";
            }
            
            return language === 'hi'
                ? "ü§ñ ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ PDCP AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§π‡•Ç‡§Å! ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä, ‡§®‡•á‡§µ‡•Ä‡§ó‡•á‡§∂‡§®, ‡§Ø‡§æ ‡§ï‡§∏‡•ç‡§ü‡§Æ‡§∞ ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§ï‡•á ‡§≤‡§ø‡§è ‡§™‡•Ç‡§õ‡•á‡§Ç‡•§ üöÄ"
                : "ü§ñ I'm your premium PDCP AI Assistant! Ask me about deliveries, navigation, or customer support. üöÄ";
        }
        
        // Initialize speech recognition
        if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                handleVoiceResult(transcript);
            };
            
            recognition.onerror = function(event) {
                console.error('Speech recognition error:', event.error);
                stopListening();
                updateCallStatus('üî¥ Voice recognition error. Please try again.');
            };
            
            recognition.onend = function() {
                stopListening();
            };
        }
        
        // Language configurations
        const languageConfig = {
            en: {
                name: 'English',
                speechLang: 'en-US',
                placeholder: 'Type your message or use voice input...',
                selectParcel: 'üöö Select Your Parcel',
                tapToSpeak: 'üéôÔ∏è Tap the microphone to speak',
                listening: 'üëÇ Listening carefully...',
                processing: 'üß† Processing your request...',
                welcome: "üöÄ Welcome to PDCP AI Assistant! I'm your premium delivery companion. Select a parcel to get started with personalized assistance! üì¶‚ú®",
                error: "üòî Sorry, I encountered an error. Please try again or contact support."
            },
            hi: {
                name: '‡§π‡§ø‡§®‡•ç‡§¶‡•Ä',
                speechLang: 'hi-IN',
                placeholder: '‡§Ö‡§™‡§®‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂ ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§µ‡•â‡§á‡§∏ ‡§á‡§®‡§™‡•Å‡§ü ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç...',
                selectParcel: 'üöö ‡§Ö‡§™‡§®‡§æ ‡§™‡§æ‡§∞‡•ç‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç',
                tapToSpeak: 'üéôÔ∏è ‡§¨‡•ã‡§≤‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§Æ‡§æ‡§á‡§ï‡•ç‡§∞‡•ã‡§´‡•ã‡§® ‡§¶‡§¨‡§æ‡§è‡§Ç',
                listening: 'üëÇ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§∏‡•á ‡§∏‡•Å‡§® ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç...',
                processing: 'üß† ‡§Ü‡§™‡§ï‡•á ‡§Ö‡§®‡•Å‡§∞‡•ã‡§ß ‡§ï‡•ã ‡§™‡•ç‡§∞‡•ã‡§∏‡•á‡§∏ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•Ç‡§Ç...',
                welcome: 'üöÄ PDCP AI ‡§Ö‡§∏‡§ø‡§∏‡•ç‡§ü‡•á‡§Ç‡§ü ‡§Æ‡•á‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§π‡•à! ‡§Æ‡•à‡§Ç ‡§Ü‡§™‡§ï‡§æ ‡§™‡•ç‡§∞‡•Ä‡§Æ‡§ø‡§Ø‡§Æ ‡§°‡§ø‡§≤‡•Ä‡§µ‡§∞‡•Ä ‡§∏‡§æ‡§•‡•Ä ‡§π‡•Ç‡§Ç‡•§ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§∏‡§π‡§æ‡§Ø‡§§‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§è‡§ï ‡§™‡§æ‡§∞‡•ç‡§∏‡§≤ ‡§ö‡•Å‡§®‡•á‡§Ç! üì¶‚ú®',
                error: 'üòî ‡§Æ‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç, ‡§Æ‡•Å‡§ù‡•á ‡§è‡§ï ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§ï‡§æ ‡§∏‡§æ‡§Æ‡§®‡§æ ‡§ï‡§∞‡§®‡§æ ‡§™‡§°‡§º‡§æ‡•§ ‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç ‡§Ø‡§æ ‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡•á ‡§∏‡§Ç‡§™‡§∞‡•ç‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§'
            },
            ta: {
                name: '‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç',
                speechLang: 'ta-IN',
                placeholder: '‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡Æø‡ÆØ‡Øà ‡Æ§‡Æü‡Øç‡Æü‡Æö‡Øç‡Æö‡ØÅ ‡Æö‡ØÜ‡ÆØ‡Øç‡ÆØ‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡Æï‡ØÅ‡Æ∞‡Æ≤‡Øç ‡Æâ‡Æ≥‡Øç‡Æ≥‡ØÄ‡Æü‡Øç‡Æü‡Øà‡Æ™‡Øç ‡Æ™‡ÆØ‡Æ©‡Øç‡Æ™‡Æü‡ØÅ‡Æ§‡Øç‡Æ§‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç...',
                selectParcel: 'üöö ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Ææ‡Æ∞‡Øç‡Æö‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç',
                tapToSpeak: 'üéôÔ∏è ‡Æ™‡Øá‡Æö ‡ÆÆ‡Øà‡Æï‡Øç‡Æ∞‡Øã‡ÆÉ‡Æ™‡Øã‡Æ©‡Øà‡Æ§‡Øç ‡Æ§‡Æü‡Øç‡Æü‡Æµ‡ØÅ‡ÆÆ‡Øç',
                listening: 'üëÇ ‡Æï‡Æµ‡Æ©‡ÆÆ‡Ææ‡Æï ‡Æï‡Øá‡Æü‡Øç‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç...',
                processing: 'üß† ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æï‡Øã‡Æ∞‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Øà ‡Æö‡ØÜ‡ÆØ‡Æ≤‡Ææ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Æø‡Æ±‡Øá‡Æ©‡Øç...',
                welcome: 'üöÄ PDCP AI ‡Æâ‡Æ§‡Æµ‡Æø‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Æø‡Æ≤‡Øç ‡Æµ‡Æ∞‡Æµ‡Øá‡Æ±‡Øç‡Æï‡Æø‡Æ±‡Øã‡ÆÆ‡Øç! ‡Æ®‡Ææ‡Æ©‡Øç ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡Øç ‡Æ™‡Æø‡Æ∞‡ØÄ‡ÆÆ‡Æø‡ÆØ‡ÆÆ‡Øç ‡Æü‡ØÜ‡Æ≤‡Æø‡Æµ‡Æ∞‡Æø ‡Æ§‡ØÅ‡Æ£‡Øà. ‡Æ§‡Æ©‡Æø‡Æ™‡Øç‡Æ™‡ÆØ‡Æ©‡Ææ‡Æï‡Øç‡Æï‡Æ™‡Øç‡Æ™‡Æü‡Øç‡Æü ‡Æâ‡Æ§‡Æµ‡Æø‡Æï‡Øç‡Æï‡Ææ‡Æï ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Ææ‡Æ∞‡Øç‡Æö‡Æ≤‡Øà‡Æ§‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æ®‡Øç‡Æ§‡ØÜ‡Æü‡ØÅ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç! üì¶‚ú®',
                error: 'üòî ‡ÆÆ‡Æ©‡Øç‡Æ©‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç, ‡Æ®‡Ææ‡Æ©‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æ™‡Æø‡Æ¥‡Øà‡ÆØ‡Øà ‡Æé‡Æ§‡Æø‡Æ∞‡Øç‡Æï‡Øä‡Æ£‡Øç‡Æü‡Øá‡Æ©‡Øç. ‡Æ§‡ÆØ‡Æµ‡ØÅ‡Æö‡ØÜ‡ÆØ‡Øç‡Æ§‡ØÅ ‡ÆÆ‡ØÄ‡Æ£‡Øç‡Æü‡ØÅ‡ÆÆ‡Øç ‡ÆÆ‡ØÅ‡ÆØ‡Æ±‡Øç‡Æö‡Æø‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç ‡ÆÖ‡Æ≤‡Øç‡Æ≤‡Æ§‡ØÅ ‡ÆÜ‡Æ§‡Æ∞‡Æµ‡Øà‡Æ§‡Øç ‡Æ§‡Øä‡Æü‡Æ∞‡Øç‡Æ™‡ØÅ ‡Æï‡Øä‡Æ≥‡Øç‡Æ≥‡ØÅ‡Æô‡Øç‡Æï‡Æ≥‡Øç.'
            },
            te: {
                name: '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å',
                speechLang: 'te-IN',
                placeholder: '‡∞Æ‡±Ä ‡∞∏‡∞Ç‡∞¶‡±á‡∞∂‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞ü‡±à‡∞™‡±ç ‡∞ö‡±á‡∞Ø‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞µ‡∞æ‡∞Ø‡∞ø‡∞∏‡±ç ‡∞á‡∞®‡±ç‚Äå‡∞™‡±Å‡∞ü‡±ç ‡∞â‡∞™‡∞Ø‡±ã‡∞ó‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø...',
                selectParcel: 'üöö ‡∞Æ‡±Ä ‡∞™‡∞æ‡∞∞‡±ç‡∞∏‡±Ü‡∞≤‡±ç‚Äå‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø',
                tapToSpeak: 'üéôÔ∏è ‡∞Æ‡∞æ‡∞ü‡±ç‡∞≤‡∞æ‡∞°‡∞ü‡∞æ‡∞®‡∞ø‡∞ï‡∞ø ‡∞Æ‡±à‡∞ï‡±ç‡∞∞‡±ã‡∞´‡±ã‡∞®‡±ç‚Äå‡∞®‡±Å ‡∞®‡±ä‡∞ï‡±ç‡∞ï‡∞Ç‡∞°‡∞ø',
                listening: 'üëÇ ‡∞ú‡∞æ‡∞ó‡±ç‡∞∞‡∞§‡±ç‡∞§‡∞ó‡∞æ ‡∞µ‡∞ø‡∞Ç‡∞ü‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å...',
                processing: 'üß† ‡∞Æ‡±Ä ‡∞Ö‡∞≠‡±ç‡∞Ø‡∞∞‡±ç‡∞•‡∞®‡∞®‡±Å ‡∞™‡±ç‡∞∞‡∞æ‡∞∏‡±Ü‡∞∏‡±ç ‡∞ö‡±á‡∞∏‡±ç‡∞§‡±Å‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å...',
                welcome: 'üöÄ PDCP AI ‡∞Ö‡∞∏‡∞ø‡∞∏‡±ç‡∞ü‡±Ü‡∞Ç‡∞ü‡±ç‚Äå‡∞ï‡±Å ‡∞∏‡±ç‡∞µ‡∞æ‡∞ó‡∞§‡∞Ç! ‡∞®‡±á‡∞®‡±Å ‡∞Æ‡±Ä ‡∞™‡±ç‡∞∞‡±Ä‡∞Æ‡∞ø‡∞Ø‡∞Ç ‡∞°‡±Ü‡∞≤‡∞ø‡∞µ‡∞∞‡±Ä ‡∞∏‡∞π‡∞ö‡∞∞‡±Å‡∞°‡∞ø‡∞®‡∞ø. ‡∞µ‡±ç‡∞Ø‡∞ï‡±ç‡∞§‡∞ø‡∞ó‡∞§‡±Ä‡∞ï‡∞∞‡∞ø‡∞Ç‡∞ö‡∞ø‡∞® ‡∞∏‡∞π‡∞æ‡∞Ø‡∞Ç ‡∞ï‡±ã‡∞∏‡∞Ç ‡∞í‡∞ï ‡∞™‡∞æ‡∞∞‡±ç‡∞∏‡±Ü‡∞≤‡±ç‚Äå‡∞®‡±Å ‡∞é‡∞Ç‡∞ö‡±Å‡∞ï‡±ã‡∞Ç‡∞°‡∞ø! üì¶‚ú®',
                error: 'üòî ‡∞ï‡±ç‡∞∑‡∞Æ‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø, ‡∞®‡±á‡∞®‡±Å ‡∞í‡∞ï ‡∞≤‡±ã‡∞™‡∞æ‡∞®‡±ç‡∞®‡∞ø ‡∞é‡∞¶‡±Å‡∞∞‡±ç‡∞ï‡±ä‡∞®‡±ç‡∞®‡∞æ‡∞®‡±Å. ‡∞¶‡∞Ø‡∞ö‡±á‡∞∏‡∞ø ‡∞Æ‡∞≥‡±ç‡∞≤‡±Ä ‡∞™‡±ç‡∞∞‡∞Ø‡∞§‡±ç‡∞®‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø ‡∞≤‡±á‡∞¶‡∞æ ‡∞Æ‡∞¶‡±ç‡∞¶‡∞§‡±Å‡∞®‡±Å ‡∞∏‡∞Ç‡∞™‡±ç‡∞∞‡∞¶‡∞ø‡∞Ç‡∞ö‡∞Ç‡∞°‡∞ø.'
            }
        };
        
        // Initialize premium features
        document.addEventListener('DOMContentLoaded', function() {
            initializeServices();
            initializeParticles();
            updateLanguageUI();
            
            // Initialize chat voice recognition
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                
                // Chat recognition
                chatRecognition = new SpeechRecognition();
                chatRecognition.continuous = false;
                chatRecognition.interimResults = false;
                chatRecognition.lang = 'en-US';
                
                chatRecognition.onresult = function(event) {
                    const transcript = event.results[0][0].transcript;
                    handleChatVoiceResult(transcript);
                };
                
                chatRecognition.onerror = function(event) {
                    console.error('Chat voice recognition error:', event.error);
                    stopChatVoice();
                };
                
                chatRecognition.onend = function() {
                    stopChatVoice();
                };
                
                console.log('üéôÔ∏è Premium chat voice recognition initialized');
            } else {
                // Disable voice button if not supported
                const voiceBtn = document.getElementById('chatVoiceBtn');
                if (voiceBtn) {
                    voiceBtn.disabled = true;
                    voiceBtn.title = 'Voice recognition not supported in this browser';
                    voiceBtn.style.opacity = '0.5';
                }
            }
            
            // Show API key status
            if (checkAPIKey()) {
                console.log('üöÄ Premium Demo ready with', window.DEMO_CONFIG.llm.provider, 'LLM');
            } else {
                console.log('üìù Premium Demo running with enhanced fallback responses. Configure API key in demo-config.js for full AI features.');
            }
            
            // Enhanced input handling
            const messageInput = document.getElementById('messageInput');
            const charCounter = document.getElementById('charCounter');
            
            messageInput.addEventListener('input', function() {
                const sendBtn = document.getElementById('sendBtn');
                sendBtn.disabled = !this.value.trim();
                
                // Update character counter
                const length = this.value.length;
                charCounter.textContent = `${length}/500`;
                
                if (length > 450) {
                    charCounter.classList.add('text-warning');
                } else if (length > 500) {
                    charCounter.classList.add('text-danger');
                } else {
                    charCounter.classList.remove('text-warning', 'text-danger');
                }
            });
            
            // Parcel selector change handler
            document.getElementById('parcelSelector').addEventListener('change', function() {
                const value = this.value;
                if (value) {
                    const parcels = {
                        'PKG001': { id: 'PKG001', destination: '123 Main Street, Mumbai', status: 'pending' },
                        'PKG002': { id: 'PKG002', destination: '456 Oak Avenue, Mumbai', status: 'in_transit' },
                        'PKG003': { id: 'PKG003', destination: '789 Pine Road, Mumbai', status: 'delayed' }
                    };
                    selectParcel(parcels[value]);
                }
            });
        });
        
        // Initialize animated particles with green and purple colors
        function initializeParticles() {
            const particlesContainer = document.getElementById('particles');
            
            function createParticle() {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Randomly choose green or purple
                if (Math.random() > 0.5) {
                    particle.classList.add('green');
                } else {
                    particle.classList.add('purple');
                }
                
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDuration = (Math.random() * 20 + 15) + 's';
                particle.style.animationDelay = Math.random() * 5 + 's';
                particlesContainer.appendChild(particle);
                
                // Remove particle after animation
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 30000);
            }
            
            // Create initial particles
            for (let i = 0; i < 15; i++) {
                setTimeout(createParticle, i * 1500);
            }
            
            // Continue creating particles
            particleInterval = setInterval(createParticle, 3000);
        }
        
        // Parcel selection with premium effects
        function selectParcel(parcel) {
            selectedParcel = parcel;
            
            const callButton = document.getElementById('callButton');
            callButton.disabled = false;
            callButton.title = 'Start premium voice call';
            
            // Add premium selection message
            addMessage('agent', `‚úÖ Perfect! I've selected parcel ${parcel.id} for ${parcel.destination}. \n\nüöÄ I'm now ready to provide personalized assistance for this delivery. You can ask me about status, location, customer details, or use the voice call feature! üìû`);
            
            // Update call interface
            updateSelectedParcelInfo();
            
            // Add visual feedback
            callButton.classList.add('animate-pulse');
            setTimeout(() => {
                callButton.classList.remove('animate-pulse');
            }, 1000);
        }
        
        // Enhanced language switching
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // Update active button with white-green-purple styling
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active', 'btn-purple', 'text-white');
                btn.classList.add('btn-white', 'text-text-primary');
            });
            
            event.target.classList.remove('btn-white', 'text-text-primary');
            event.target.classList.add('active', 'btn-purple', 'text-white');
            
            // Update speech recognition language for both call and chat
            const config = languageConfig[lang];
            if (recognition) {
                recognition.lang = config.speechLang;
            }
            if (chatRecognition) {
                chatRecognition.lang = config.speechLang;
            }
            
            updateLanguageUI();
            
            // Add premium language change message
            addMessage('agent', config.welcome);
            
            console.log(`üåç Language changed to ${config.name} (${config.speechLang})`);
        }
        
        function updateLanguageUI() {
            const config = languageConfig[currentLanguage];
            
            // Update placeholders and text
            document.getElementById('messageInput').placeholder = config.placeholder;
        }
        
        // Enhanced chat functionality
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            const newHeight = Math.min(Math.max(textarea.scrollHeight, 48), 120);
            textarea.style.height = newHeight + 'px';
        }
        
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || message.length > 500) return;
            
            // Add user message with premium styling
            addMessage('user', message);
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('sendBtn').disabled = true;
            document.getElementById('charCounter').textContent = '0/500';
            
            // Show premium typing indicator
            showTypingIndicator();
            
            // Process with LLM service
            llmService.processMessage(message, selectedParcel, currentLanguage)
                .then(response => {
                    hideTypingIndicator();
                    addMessage('agent', response);
                    
                    // Auto-speak response if enabled
                    if (autoSpeakEnabled) {
                        speakChatMessage(response, currentLanguage);
                    }
                })
                .catch(error => {
                    console.error('Message processing error:', error);
                    hideTypingIndicator();
                    const config = languageConfig[currentLanguage];
                    const errorMsg = config?.error || 'Sorry, I encountered an error. Please try again.';
                    addMessage('agent', errorMsg);
                    
                    if (autoSpeakEnabled) {
                        speakChatMessage(errorMsg, currentLanguage);
                    }
                });
        }
        
        function addMessage(sender, text) {
            const messagesArea = document.getElementById('messagesArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender} message-enter mb-6`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3 justify-end">
                        <div class="flex-1 text-right">
                            <div class="inline-block bg-gradient-to-r from-primary to-secondary rounded-2xl rounded-tr-md p-4 shadow-card max-w-xs lg:max-w-sm">
                                <p class="text-white leading-relaxed">${text}</p>
                            </div>
                            <div class="flex items-center justify-end space-x-2 mt-2 mr-2">
                                <div class="flex space-x-1">
                                    <div class="w-1 h-1 bg-success rounded-full"></div>
                                    <div class="w-1 h-1 bg-success rounded-full"></div>
                                </div>
                                <span class="text-xs text-text-secondary">${timeString}</span>
                            </div>
                        </div>
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-accent to-success flex items-center justify-center flex-shrink-0 mt-1">
                            <span class="material-symbols-outlined text-white text-sm">person</span>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-primary to-secondary flex items-center justify-center flex-shrink-0 mt-1">
                            <span class="material-symbols-outlined text-white text-sm">psychology</span>
                        </div>
                        <div class="flex-1">
                            <div class="glass-dark rounded-2xl rounded-tl-md p-4 shadow-card max-w-xs lg:max-w-sm">
                                <p class="text-text-primary leading-relaxed">${text}</p>
                            </div>
                            <div class="flex items-center space-x-2 mt-2 ml-2">
                                <span class="text-xs text-text-secondary">${timeString}</span>
                                <div class="flex space-x-1">
                                    <div class="w-1 h-1 bg-success rounded-full"></div>
                                    <div class="w-1 h-1 bg-success rounded-full"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            messagesArea.appendChild(messageDiv);
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        function showTypingIndicator() {
            document.getElementById('typingIndicator').classList.remove('hidden');
            const messagesArea = document.getElementById('messagesArea');
            messagesArea.scrollTop = messagesArea.scrollHeight;
        }
        
        function hideTypingIndicator() {
            document.getElementById('typingIndicator').classList.add('hidden');
        }
        
        // Quick message functionality
        function sendQuickMessage(type) {
            const messages = {
                'status': 'What is the current status of my delivery?',
                'location': 'Where is my parcel right now?',
                'help': 'I need help with my delivery'
            };
            
            const input = document.getElementById('messageInput');
            input.value = messages[type] || '';
            adjustTextareaHeight(input);
            document.getElementById('sendBtn').disabled = false;
        }
        
        // Premium call interface
        function startCall() {
            if (!selectedParcel) {
                // Premium alert styling could be added here
                alert('üöö Please select a parcel first to start your premium voice assistance session!');
                return;
            }
            
            document.getElementById('callOverlay').classList.remove('hidden');
            callStartTime = new Date();
            startCallDurationTimer();
            updateSelectedParcelInfo();
            
            // Premium welcome message
            setTimeout(() => {
                const config = languageConfig[currentLanguage];
                updateCallStatus(config.tapToSpeak);
            }, 1000);
        }
        
        function endCall() {
            document.getElementById('callOverlay').classList.add('hidden');
            
            if (callDurationInterval) {
                clearInterval(callDurationInterval);
                callDurationInterval = null;
            }
            
            callStartTime = null;
            stopListening();
            updateCallStatus('');
            hideTranscript();
            hideVoiceWaves();
        }
        
        function startCallDurationTimer() {
            callDurationInterval = setInterval(() => {
                if (callStartTime) {
                    const now = new Date();
                    const duration = Math.floor((now - callStartTime) / 1000);
                    const minutes = Math.floor(duration / 60);
                    const seconds = duration % 60;
                    document.getElementById('callDuration').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }
        
        function toggleVoiceRecognition() {
            if (isListening) {
                stopListening();
            } else {
                startListening();
            }
        }
        
        function startListening() {
            if (!recognition) {
                updateCallStatus('üî¥ Voice recognition not supported in this browser');
                return;
            }
            
            isListening = true;
            const voiceBtn = document.getElementById('voiceBtn');
            
            // Premium visual feedback with white-green-purple colors
            voiceBtn.querySelector('div').classList.add('btn-danger');
            voiceBtn.querySelector('div').classList.remove('gradient-green-purple');
            
            showVoiceWaves();
            
            const config = languageConfig[currentLanguage];
            updateCallStatus(config.listening);
            
            try {
                recognition.start();
            } catch (error) {
                console.error('Failed to start recognition:', error);
                stopListening();
            }
        }
        
        function stopListening() {
            if (!isListening) return;
            
            isListening = false;
            const voiceBtn = document.getElementById('voiceBtn');
            
            // Reset premium visual feedback with white-green-purple colors
            voiceBtn.querySelector('div').classList.remove('btn-danger');
            voiceBtn.querySelector('div').classList.add('gradient-green-purple');
            
            hideVoiceWaves();
            
            const config = languageConfig[currentLanguage];
            updateCallStatus(config.tapToSpeak);
            
            if (recognition) {
                recognition.stop();
            }
        }
        
        function showVoiceWaves() {
            document.getElementById('voiceWaves').classList.remove('hidden');
            document.getElementById('avatarDefault').classList.add('hidden');
        }
        
        function hideVoiceWaves() {
            document.getElementById('voiceWaves').classList.add('hidden');
            document.getElementById('avatarDefault').classList.remove('hidden');
        }
        
        function handleVoiceResult(transcript) {
            showTranscript(transcript);
            
            const config = languageConfig[currentLanguage];
            updateCallStatus(config.processing);
            
            // Process with LLM service
            llmService.processMessage(transcript, selectedParcel, currentLanguage)
                .then(response => {
                    // Speak in the current language
                    speak(response, currentLanguage);
                    
                    // Also add to chat
                    addMessage('user', transcript);
                    addMessage('agent', response);
                    
                    const config = languageConfig[currentLanguage];
                    updateCallStatus(config.tapToSpeak);
                })
                .catch(error => {
                    console.error('Voice processing error:', error);
                    const errorMsg = languageConfig[currentLanguage]?.error || 'Sorry, I encountered an error.';
                    speak(errorMsg, currentLanguage);
                    
                    const config = languageConfig[currentLanguage];
                    updateCallStatus(config.tapToSpeak);
                });
        }
        
        function speak(text, forceLanguage = null) {
            if (!synthesis) return;
            
            isSpeaking = true;
            updateCallStatus('üó£Ô∏è Speaking...');
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = getOptimalSpeechRate(forceLanguage || currentLanguage);
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Set language-specific voice
            const targetLang = forceLanguage || currentLanguage;
            const speechLang = languageConfig[targetLang]?.speechLang || 'en-US';
            utterance.lang = speechLang;
            
            const voices = synthesis.getVoices();
            const targetVoice = voices.find(voice => 
                voice.lang.startsWith(speechLang) || 
                voice.lang.startsWith(speechLang.split('-')[0])
            );
            
            if (targetVoice) {
                utterance.voice = targetVoice;
                console.log(`üó£Ô∏è Speaking in ${targetVoice.name} (${targetVoice.lang})`);
            } else {
                console.log(`‚ö†Ô∏è No voice found for ${speechLang}, using default`);
            }
            
            utterance.onend = () => {
                isSpeaking = false;
                const config = languageConfig[currentLanguage];
                updateCallStatus(config.tapToSpeak);
            };
            
            utterance.onerror = (error) => {
                console.error('Speech synthesis error:', error);
                isSpeaking = false;
                const config = languageConfig[currentLanguage];
                updateCallStatus(config.tapToSpeak);
            };
            
            synthesis.speak(utterance);
        }
        
        // Get optimal speech rate for different languages
        function getOptimalSpeechRate(language) {
            const rates = {
                'en': 0.9,
                'hi': 0.7,
                'ta': 0.7,
                'te': 0.7,
            };
            return rates[language] || 0.9;
        }
        
        function updateCallStatus(status) {
            document.getElementById('callStatus').textContent = status;
        }
        
        function showTranscript(text) {
            document.getElementById('transcriptText').textContent = text;
            document.getElementById('callTranscript').classList.remove('hidden');
        }
        
        function hideTranscript() {
            document.getElementById('callTranscript').classList.add('hidden');
        }
        
        function updateSelectedParcelInfo() {
            if (selectedParcel) {
                document.getElementById('selectedParcelText').textContent = 
                    `${selectedParcel.id} - ${selectedParcel.destination}`;
                document.getElementById('selectedParcelInfo').classList.remove('hidden');
            }
        }
        
        // Premium Chat Voice Functions
        function toggleChatVoice() {
            if (!chatRecognition) {
                alert('üéôÔ∏è Voice recognition not supported in this browser. Please use Chrome or Edge for the best experience.');
                return;
            }
            
            if (isChatListening) {
                stopChatVoice();
            } else {
                startChatVoice();
            }
        }
        
        function startChatVoice() {
            if (isChatListening) return;
            
            isChatListening = true;
            const voiceBtn = document.getElementById('chatVoiceBtn');
            voiceBtn.classList.remove('btn-green');
            voiceBtn.classList.add('btn-danger', 'pulse-advanced');
            voiceBtn.title = 'üî¥ Listening... Click to stop';
            
            // Set language for recognition
            const config = languageConfig[currentLanguage];
            chatRecognition.lang = config.speechLang;
            
            try {
                chatRecognition.start();
                console.log('üéôÔ∏è Started premium chat voice recognition in', config.speechLang);
            } catch (error) {
                console.error('Failed to start chat voice recognition:', error);
                stopChatVoice();
            }
        }
        
        function stopChatVoice() {
            if (!isChatListening) return;
            
            isChatListening = false;
            const voiceBtn = document.getElementById('chatVoiceBtn');
            voiceBtn.classList.remove('btn-danger', 'pulse-advanced');
            voiceBtn.classList.add('btn-green');
            voiceBtn.title = 'üéôÔ∏è Voice input';
            
            if (chatRecognition) {
                chatRecognition.stop();
            }
        }
        
        function handleChatVoiceResult(transcript) {
            console.log('üó£Ô∏è Premium chat voice input:', transcript);
            
            // Add the transcript to the input field with premium animation
            const input = document.getElementById('messageInput');
            input.value = transcript;
            adjustTextareaHeight(input);
            
            // Enable send button
            document.getElementById('sendBtn').disabled = false;
            
            // Update character counter
            const charCounter = document.getElementById('charCounter');
            charCounter.textContent = `${transcript.length}/500`;
            
            // Add visual feedback
            input.classList.add('animate-pulse');
            setTimeout(() => {
                input.classList.remove('animate-pulse');
            }, 500);
        }
        
        function toggleAutoSpeak() {
            autoSpeakEnabled = !autoSpeakEnabled;
            const speakBtn = document.getElementById('speakBtn');
            
            if (autoSpeakEnabled) {
                speakBtn.classList.remove('btn-white', 'text-text-secondary');
                speakBtn.classList.add('btn-green', 'text-white', 'shadow-glow-green');
                speakBtn.title = 'üîä Auto-speak ON - Premium voice responses enabled';
                console.log('üîä Premium auto-speak enabled');
            } else {
                speakBtn.classList.remove('btn-green', 'text-white', 'shadow-glow-green');
                speakBtn.classList.add('btn-white', 'text-text-secondary');
                speakBtn.title = 'üîá Auto-speak OFF - Click to enable premium voice responses';
                console.log('üîá Premium auto-speak disabled');
            }
        }
        
        function speakChatMessage(text, language) {
            if (!autoSpeakEnabled || !synthesis) return;
            
            // Stop any ongoing speech
            synthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.rate = getOptimalSpeechRate(language);
            utterance.pitch = 1.0;
            utterance.volume = 1.0;
            
            // Set language-specific voice
            const config = languageConfig[language];
            if (config && config.speechLang) {
                utterance.lang = config.speechLang;
                
                const voices = synthesis.getVoices();
                const targetVoice = voices.find(voice => 
                    voice.lang.startsWith(config.speechLang) || 
                    voice.lang.startsWith(config.speechLang.split('-')[0])
                );
                
                if (targetVoice) {
                    utterance.voice = targetVoice;
                    console.log(`üó£Ô∏è Speaking premium chat message in ${targetVoice.name} (${targetVoice.lang})`);
                }
            }
            
            synthesis.speak(utterance);
        }
        
        // Load voices when available
        if (synthesis) {
            synthesis.onvoiceschanged = function() {
                console.log('üéµ Premium voices loaded');
            };
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            if (particleInterval) {
                clearInterval(particleInterval);
            }
        });
    </script>
</body>
</html>